<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="API references" href="../../pages/api_references.html" /><link rel="prev" title="Align low-resolution brain volumes of 2 individuals with fMRI data" href="plot_1_aligning_low_res_volumes.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>Align low-resolution brain volumes of 2 individuals with fMRI data - FUGW</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #232629;
  --color-code-foreground: #cccccc;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #232629;
  --color-code-foreground: #cccccc;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">FUGW</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">FUGW</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../pages/introduction.html">Introduction</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../00_basics/index.html">ðŸ“š Basics</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../00_basics/plot_1_dense.html">Transport distributions using dense solvers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../00_basics/plot_2_1_lmds.html">Generate embeddings from mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../00_basics/plot_2_2_coarse_to_fine.html">Transport distributions using sparse solvers</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../01_brain_alignment/index.html">ðŸ§  Brain alignment</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../01_brain_alignment/plot_1_aligning_brain_dense.html">Align low-resolution brain surfaces of 2 individuals with fMRI data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../01_brain_alignment/plot_2_aligning_brain_sparse.html">Align high-resolution brain surfaces of 2 individuals with fMRI data</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">ðŸ§Š Volumetric alignments</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_1_aligning_low_res_volumes.html">Align low-resolution brain volumes of 2 individuals with fMRI data</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Align low-resolution brain volumes of 2 individuals with fMRI data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../pages/api_references.html">API references</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../modules/mappings.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fugw.mappings</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../modules/mappings.FUGW.html"><code class="docutils literal notranslate"><span class="pre">FUGW</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../modules/mappings.FUGWSparse.html"><code class="docutils literal notranslate"><span class="pre">FUGWSparse</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../modules/solvers.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fugw.solvers</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../modules/solvers.FUGWSolver.html"><code class="docutils literal notranslate"><span class="pre">FUGWSolver</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../modules/solvers.FUGWSparseSolver.html"><code class="docutils literal notranslate"><span class="pre">FUGWSparseSolver</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pages/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/alexisthual/fugw">GitHub repository</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-02-volumetric-alignment-plot-2-aligning-high-res-volumes-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="align-low-resolution-brain-volumes-of-2-individuals-with-fmri-data">
<span id="sphx-glr-auto-examples-02-volumetric-alignment-plot-2-aligning-high-res-volumes-py"></span><h1>Align low-resolution brain volumes of 2 individuals with fMRI data<a class="headerlink" href="#align-low-resolution-brain-volumes-of-2-individuals-with-fmri-data" title="Permalink to this heading">#</a></h1>
<p>In this example, we align 2 low-resolution brain volumes
using 4 fMRI feature maps (z-score contrast maps).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">image</span>
<span class="kn">from</span> <span class="nn">fugw.mappings</span> <span class="kn">import</span> <a href="../../modules/mappings.FUGW.html#fugw.mappings.FUGW" title="fugw.mappings.FUGW" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class"><span class="n">FUGW</span></a><span class="p">,</span> <a href="../../modules/mappings.FUGWSparse.html#fugw.mappings.FUGWSparse" title="fugw.mappings.FUGWSparse" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class"><span class="n">FUGWSparse</span></a>
<span class="kn">from</span> <span class="nn">fugw.scripts</span> <span class="kn">import</span> <span class="n">coarse_to_fine</span><span class="p">,</span> <span class="n">lmds</span>

<a href="https://matplotlib.org/stable/api/matplotlib_configuration_api.html#matplotlib.RcParams" title="matplotlib.RcParams" class="sphx-glr-backref-module-matplotlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span></a><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
</pre></div>
</div>
<p>We first fetch 5 contrasts for each subject from the localizer dataset.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_subjects</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">contrasts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;sentence reading vs checkerboard&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sentence listening&quot;</span><span class="p">,</span>
    <span class="s2">&quot;calculation vs sentences&quot;</span><span class="p">,</span>
    <span class="s2">&quot;left vs right button press&quot;</span><span class="p">,</span>
    <span class="s2">&quot;checkerboard&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">n_training_contrasts</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">brain_data</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_localizer_contrasts</span><span class="p">(</span>
    <span class="n">contrasts</span><span class="p">,</span>
    <span class="n">n_subjects</span><span class="o">=</span><span class="n">n_subjects</span><span class="p">,</span>
    <span class="n">get_anats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">source_imgs_paths</span> <span class="o">=</span> <span class="n">brain_data</span><span class="p">[</span><span class="s2">&quot;cmaps&quot;</span><span class="p">][</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">contrasts</span><span class="p">)]</span>
<span class="n">target_imgs_paths</span> <span class="o">=</span> <span class="n">brain_data</span><span class="p">[</span><span class="s2">&quot;cmaps&quot;</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">contrasts</span><span class="p">)</span> <span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">contrasts</span><span class="p">)]</span>

<span class="n">source_im</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">load_img</span><span class="p">(</span><span class="n">source_imgs_paths</span><span class="p">)</span>
<span class="n">target_im</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">load_img</span><span class="p">(</span><span class="n">target_imgs_paths</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.8/site-packages/nilearn/datasets/func.py:893: UserWarning:

`legacy_format` will default to `False` in release 0.11. Dataset fetchers will then return pandas dataframes by default instead of recarrays.
</pre></div>
</div>
<p>Letâ€™s use a geometry of 7633 voxels.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SCALE_FACTOR</span> <span class="o">=</span> <span class="mi">2</span>

<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_maps</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.nan_to_num.html#numpy.nan_to_num" title="numpy.nan_to_num" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span></a><span class="p">(</span>
    <span class="n">source_im</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()[::</span><span class="n">SCALE_FACTOR</span><span class="p">,</span> <span class="p">::</span><span class="n">SCALE_FACTOR</span><span class="p">,</span> <span class="p">::</span><span class="n">SCALE_FACTOR</span><span class="p">]</span>
<span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_maps</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.nan_to_num.html#numpy.nan_to_num" title="numpy.nan_to_num" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span></a><span class="p">(</span>
    <span class="n">target_im</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()[::</span><span class="n">SCALE_FACTOR</span><span class="p">,</span> <span class="p">::</span><span class="n">SCALE_FACTOR</span><span class="p">,</span> <span class="p">::</span><span class="n">SCALE_FACTOR</span><span class="p">]</span>
<span class="p">)</span>

<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">segmentation_fine</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">isnan</span></a><span class="p">(</span><span class="n">source_im</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]))</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">segmentation_coarse</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">segmentation_fine</span></a><span class="p">[</span>
    <span class="p">::</span><span class="n">SCALE_FACTOR</span><span class="p">,</span> <span class="p">::</span><span class="n">SCALE_FACTOR</span><span class="p">,</span> <span class="p">::</span><span class="n">SCALE_FACTOR</span>
<span class="p">]</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="numpy.array" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.nonzero.html#numpy.nonzero" title="numpy.nonzero" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">segmentation_coarse</span></a><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_features</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_maps</span></a><span class="p">[</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">T</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_features</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_maps</span></a><span class="p">[</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">T</span>

<a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="matplotlib.pyplot.figure" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.add_subplot" title="matplotlib.figure.Figure.add_subplot" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span></a><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.scatter.html#matplotlib.axes.Axes.scatter" title="matplotlib.axes.Axes.scatter" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">135</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_axis_off.html#matplotlib.axes.Axes.set_axis_off" title="matplotlib.axes.Axes.set_axis_off" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span></a><span class="p">()</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_2_aligning_high_res_volumes_001.png" srcset="../../_images/sphx_glr_plot_2_aligning_high_res_volumes_001.png" alt="plot 2 aligning high res volumes" class = "sphx-glr-single-img"/><p>We then compute the distance matrix between voxel coordinates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source_geometry_embeddings</span> <span class="o">=</span> <span class="n">lmds</span><span class="o">.</span><span class="n">compute_lmds_volume</span><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">segmentation_coarse</span></a>
<span class="p">)</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">()</span>
<span class="n">target_geometry_embeddings</span> <span class="o">=</span> <span class="n">source_geometry_embeddings</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

<span class="c1"># Show the embedding shape</span>
<span class="nb">print</span><span class="p">(</span><span class="n">source_geometry_embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>torch.Size([7633, 3])
</pre></div>
</div>
<p>In order to avoid numerical errors when fitting the mapping, we normalize
both the features and the geometry.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_features_normalized</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_features</span></a> <span class="o">/</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.norm.html#numpy.linalg.norm" title="numpy.linalg.norm" class="sphx-glr-backref-module-numpy-linalg sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span></a><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_features</span></a><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_features_normalized</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_features</span></a> <span class="o">/</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.norm.html#numpy.linalg.norm" title="numpy.linalg.norm" class="sphx-glr-backref-module-numpy-linalg sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span></a><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_features</span></a><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">source_embeddings_normalized</span><span class="p">,</span> <span class="n">source_distance_max</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">coarse_to_fine</span><span class="o">.</span><span class="n">random_normalizing</span><span class="p">(</span><span class="n">source_geometry_embeddings</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">target_embeddings_normalized</span><span class="p">,</span> <span class="n">target_distance_max</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">coarse_to_fine</span><span class="o">.</span><span class="n">random_normalizing</span><span class="p">(</span><span class="n">target_geometry_embeddings</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We now fit the mapping using the sinkhorn solver and 3 BCD iterations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alpha_coarse</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">rho_coarse</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">eps_coarse</span> <span class="o">=</span> <span class="mf">1e-4</span>
<a href="../../modules/mappings.FUGW.html#fugw.mappings.FUGW" title="fugw.mappings.FUGW" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coarse_mapping</span></a> <span class="o">=</span> <a href="../../modules/mappings.FUGW.html#fugw.mappings.FUGW" title="fugw.mappings.FUGW" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class"><span class="n">FUGW</span></a><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha_coarse</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho_coarse</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps_coarse</span><span class="p">)</span>
<span class="n">coarse_mapping_solver</span> <span class="o">=</span> <span class="s2">&quot;mm&quot;</span>
<span class="n">coarse_mapping_solver_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;nits_bcd&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;tol_uot&quot;</span><span class="p">:</span> <span class="mf">1e-10</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">alpha_fine</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">rho_fine</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">eps_fine</span> <span class="o">=</span> <span class="mf">1e-4</span>
<a href="../../modules/mappings.FUGWSparse.html#fugw.mappings.FUGWSparse" title="fugw.mappings.FUGWSparse" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fine_mapping</span></a> <span class="o">=</span> <a href="../../modules/mappings.FUGWSparse.html#fugw.mappings.FUGWSparse" title="fugw.mappings.FUGWSparse" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class"><span class="n">FUGWSparse</span></a><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha_fine</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho_fine</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps_fine</span><span class="p">)</span>
<span class="n">fine_mapping_solver</span> <span class="o">=</span> <span class="s2">&quot;mm&quot;</span>
<span class="n">fine_mapping_solver_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;nits_bcd&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;tol_uot&quot;</span><span class="p">:</span> <span class="mf">1e-10</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Letâ€™s subsample the vertices.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_sample</span></a> <span class="o">=</span> <span class="n">coarse_to_fine</span><span class="o">.</span><span class="n">sample_volume_uniformly</span><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">segmentation_coarse</span></a><span class="p">,</span>
    <span class="n">embeddings</span><span class="o">=</span><span class="n">source_geometry_embeddings</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_sample</span></a> <span class="o">=</span> <span class="n">coarse_to_fine</span><span class="o">.</span><span class="n">sample_volume_uniformly</span><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">segmentation_coarse</span></a><span class="p">,</span>
    <span class="n">embeddings</span><span class="o">=</span><span class="n">target_geometry_embeddings</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.8/site-packages/sklearn/cluster/_agglomerative.py:282: UserWarning:

the number of connected components of the connectivity matrix is 3 &gt; 1. Completing it to avoid stopping the tree early.

/usr/local/lib/python3.8/site-packages/sklearn/cluster/_agglomerative.py:282: UserWarning:

the number of connected components of the connectivity matrix is 3 &gt; 1. Completing it to avoid stopping the tree early.
</pre></div>
</div>
<p>Train both the coarse and the fine mapping.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coarse_to_fine</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="c1"># Source and target&#39;s features and embeddings</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_features</span></a><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_features_normalized</span></a><span class="p">[:</span><span class="n">n_training_contrasts</span><span class="p">,</span> <span class="p">:],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_features</span></a><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_features_normalized</span></a><span class="p">[:</span><span class="n">n_training_contrasts</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">source_geometry_embeddings</span><span class="o">=</span><span class="n">source_embeddings_normalized</span><span class="p">,</span>
    <span class="n">target_geometry_embeddings</span><span class="o">=</span><span class="n">target_embeddings_normalized</span><span class="p">,</span>
    <span class="c1"># Parametrize step 1 (coarse alignment between source and target)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_sample</span></a><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_sample</span></a><span class="p">,</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_sample</span></a><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_sample</span></a><span class="p">,</span>
    <a href="../../modules/mappings.FUGW.html#fugw.mappings.FUGW" title="fugw.mappings.FUGW" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coarse_mapping</span></a><span class="o">=</span><a href="../../modules/mappings.FUGW.html#fugw.mappings.FUGW" title="fugw.mappings.FUGW" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coarse_mapping</span></a><span class="p">,</span>
    <span class="n">coarse_mapping_solver</span><span class="o">=</span><span class="n">coarse_mapping_solver</span><span class="p">,</span>
    <span class="n">coarse_mapping_solver_params</span><span class="o">=</span><span class="n">coarse_mapping_solver_params</span><span class="p">,</span>
    <span class="c1"># Parametrize step 2 (selection of pairs of indices present in</span>
    <span class="c1"># fine-grained&#39;s sparsity mask)</span>
    <span class="n">coarse_pairs_selection_method</span><span class="o">=</span><span class="s2">&quot;topk&quot;</span><span class="p">,</span>
    <span class="n">source_selection_radius</span><span class="o">=</span><span class="mi">3</span> <span class="o">/</span> <span class="n">source_distance_max</span><span class="p">,</span>
    <span class="n">target_selection_radius</span><span class="o">=</span><span class="mi">3</span> <span class="o">/</span> <span class="n">target_distance_max</span><span class="p">,</span>
    <span class="c1"># Parametrize step 3 (fine-grained alignment)</span>
    <a href="../../modules/mappings.FUGWSparse.html#fugw.mappings.FUGWSparse" title="fugw.mappings.FUGWSparse" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fine_mapping</span></a><span class="o">=</span><a href="../../modules/mappings.FUGWSparse.html#fugw.mappings.FUGWSparse" title="fugw.mappings.FUGWSparse" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fine_mapping</span></a><span class="p">,</span>
    <span class="n">fine_mapping_solver</span><span class="o">=</span><span class="n">fine_mapping_solver</span><span class="p">,</span>
    <span class="n">fine_mapping_solver_params</span><span class="o">=</span><span class="n">fine_mapping_solver_params</span><span class="p">,</span>
    <span class="c1"># Misc</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[19:12:37] BCD step 1/5    FUGW loss:      0.02423551119863987      dense.py:464


[19:12:51] BCD step 2/5    FUGW loss:      0.01868680864572525      dense.py:464


[19:13:06] BCD step 3/5    FUGW loss:      0.012388878501951694     dense.py:464


[19:13:21] BCD step 4/5    FUGW loss:      0.006114030256867409     dense.py:464


[19:13:43] BCD step 5/5    FUGW loss:      0.004022807814180851     dense.py:464


[19:16:40] BCD step 1/3    FUGW loss:      0.004291206132620573    sparse.py:512


[19:19:37] BCD step 2/3    FUGW loss:      0.003227503038942814    sparse.py:512


[19:22:33] BCD step 3/3    FUGW loss:      0.0028412765823304653   sparse.py:512

(tensor([6131, 1014, 4663, 7041, 5816, 7544,  499, 3353, 7189, 5401, 2610, 1091,
         651, 6805,  639, 3049, 1995, 1838, 2060, 1171,  409, 1898, 1376,  487,
        3907, 3897,  881, 6491, 3648,  969, 1936, 6644, 6319, 5345, 6360, 5271,
        7000, 4518, 3228, 6566, 2212, 6433,  902, 7013, 5205, 7043, 2910, 3473,
        1085, 6231, 1652, 1317,  834, 6309, 3652, 1361, 3532, 5048, 7226, 1597,
        6264, 5356, 6278,   27, 6183, 1803,   26, 4373, 5850,   45, 7425,   89,
        4050, 2686, 4014, 4358, 3595, 1348,  521, 3974, 6436, 4021, 4888, 4891,
        5171,   39, 1131, 7546,  242, 3884, 2784, 5595, 3889,  781,    3,  119,
        1324, 6337, 6515, 6486, 2421, 5294,  745, 5181, 4039, 5444, 6589, 2684,
        3241,  972, 2052, 2000, 4145, 5855, 4132, 1883, 3745, 7609, 2978, 4912,
        7263,  733, 1431, 2119, 2048, 2592, 1562, 4052, 7421, 6836, 3678, 2169,
        4983, 4686, 4025, 6882, 1078, 3788, 2794, 4763, 3359,  971, 2071,  470,
        1763, 4472,  857, 5491,  551, 3650, 2024, 4183, 7223, 2005, 2496, 4989,
        4579, 2800,  879, 1499, 6284, 3669, 1335, 5546, 2893, 2788, 4346, 6099,
         913, 2697, 3069, 5011, 6270, 6995, 2844, 5016, 5216, 2804, 2993, 4343,
        5698, 3755, 1612, 3330, 3849,   82,  859, 2793, 2235,  203, 4179, 2012,
         983, 4277, 5134, 5426, 5609,  128, 2695, 7407, 5324, 6572,  673, 3196,
          34, 6891, 2942, 4001, 4830, 3959, 7337, 3859, 6832, 2530,  828, 6338,
        6243, 4698, 5361, 2749,  909, 6603, 4906, 4651, 1641, 4493,  800, 2126,
        7156, 3385, 3336, 2487, 1124, 4806, 7254, 3108, 7133,  309, 4784, 1415,
        4335, 4853,  585, 3534,  434,  456, 3312, 3087, 2999, 5515, 7074, 3759,
        5570, 3847,  931, 3289, 7463, 2214, 6091, 3275, 2489, 3656, 6130, 1892,
        6373, 4124, 6089, 7564, 3298, 4705, 6808, 2264,  636, 2564, 1219, 6660,
        1071, 7583, 1106, 3020, 4875, 2747, 1527, 5516, 7035, 5520, 4761, 5956,
        6168, 6204, 4629, 7442,  753,  347, 5081, 6079, 2385, 1717, 6036, 3240,
        5137, 1026, 1845, 1914, 6406, 6825, 7460, 1935, 6796, 5477, 6146, 4859,
        7576, 5596, 6635, 2997,  480, 3773, 3333, 5553, 6391, 4510, 6318, 5667,
        4267, 4313, 6973, 3614, 4221, 3174, 1163, 5845, 6546, 4234, 5944, 1161,
        7389, 2992, 1654, 3488, 2849, 4398, 4758, 3432, 5224, 3920, 2467, 6530,
        2975, 6865, 5107, 1086, 6645, 2897,  210,  615, 2514, 3831,  933, 7341,
        6741, 6488,  588, 4316,  413, 3466, 2854, 1605, 6116,  259, 5228, 3517,
        1916, 1079,  954, 6628, 3025, 7238, 2547, 1310, 3937, 6870, 7143, 7619,
        7127, 6916, 7482, 5306, 3036, 6248, 5795, 6423, 6333, 1952, 1665, 4249,
        1019, 2305, 6600, 4082, 7100, 4181, 2980, 7500, 6630, 7383, 2007,  775,
        7323, 4745, 3250, 2263, 1204, 4931,  570, 7419, 3142,    4, 1799, 3552,
        7604, 6059, 3187, 3340, 2223, 3841,  111, 3209, 4091, 2316, 4873,  541,
        6187, 3616, 3235, 4883,  868, 2186, 1937, 4624,  718, 1461, 3476,  482,
        1897, 5618,  704, 5141, 6581, 5749, 5995, 3807, 4961, 5117, 4008, 5840,
        5103, 5999,  224, 7497,  148,  159, 6076, 5542,  815, 7077, 4000,  504,
        3721, 2680, 3361,  661, 2365, 5202, 3489, 6456,   92, 2308, 6887, 3928,
        5927, 2738, 5254, 7554, 3176,  922,  440, 4973, 1306, 1143, 1033, 2520,
         719, 3804, 4437, 1139, 4199, 5249, 1748, 6160, 4487, 5952, 6560, 1502,
        1548, 7275, 3129, 4045,  926, 2717, 1626, 4539,  897, 1099, 2615, 2289,
        6002, 6687, 4499, 2393, 2203,  145, 2770, 2851,  906, 3350, 6889, 3483,
        1000,  701,  573, 1867, 3760, 6282, 3146, 2065, 1787, 7078, 7071, 5902,
        2164,  244, 5050, 2861,  364, 5021, 4594, 5802, 6988, 5518, 1059,  850,
        1907, 2440, 3136, 1625, 2345, 2041, 1603, 5536,  262, 5580, 4057, 4135,
        2240,  401, 4417, 1031, 2768, 5097, 1552, 3813, 7480, 6947, 4368, 7286,
        2352, 7011, 3188,  900, 4536, 3903, 6537, 4913, 5394, 3886, 6907, 3375,
        7058, 7432, 6307,  116, 2215, 6261, 6834, 5474, 1671, 2437, 7129, 3639,
        1365,  734, 5746, 2222, 1840,  233, 2965, 2512, 6448, 5253, 7439, 7626,
        5812, 2600, 6133, 5259, 6465, 6780, 1836, 4444, 6411, 1259, 1664, 4161,
        7368,  945, 2988, 2633, 6953, 1454, 6748, 7099, 7300, 3478, 1784, 6733,
        3704, 5264, 3896, 5897, 6009, 5772, 3301, 7474, 6871, 5730, 5533, 1873,
        3548, 6699, 4630,  818, 6737, 7470, 6232, 6312, 3677, 7295, 2618, 6478,
        7579,  247, 5843, 6557, 5884, 2502, 7032, 5127, 2162,  860, 1792, 4219,
        6606, 2847, 5286,  192, 3133, 4106, 3151, 3635, 4703, 7537, 1228, 7347,
        1485, 1100, 5776, 6676, 5867, 6977, 5945, 1477, 1684, 2930, 5367, 2042,
         266, 4653, 2121, 4868, 3930, 7284, 6782, 5860, 5947, 2558, 2927, 2579,
        4644, 6514, 5631, 3864, 2536, 2194, 4690, 2072,  980, 1600, 4355, 5292,
        3799, 1168, 3918, 5459, 3399,  590, 2429, 1556, 4474, 1287, 3523, 2408,
        5505,  672, 3624, 4172, 5973, 3417,  631, 4829, 4994, 6793, 1812, 6330,
        2880, 2884, 5781, 1254, 5838, 6613, 1864, 6693, 3513,  904, 4468,  635,
           1, 3521,  392, 4158, 5191, 1006, 4987,  810, 2895, 1135, 3708, 1590,
        5675, 5724, 5299, 7398, 2623, 4566, 2329, 3243, 6968, 4695, 3215, 5957,
        7203, 4097, 2741, 4628, 4731, 3979, 3983,  370, 6147, 3545, 2638, 5718,
        6434, 1614, 7326,  698, 2874, 2543,  871, 2016, 1843, 6210, 5023, 4667,
        6056, 6365, 4163, 4023, 2057,  327,  110, 4126,  693, 2817, 3879, 2743,
        7632, 4266, 5235, 4898,  437, 1040,  830,  335, 3445, 7585, 2905, 1753,
        6440, 2718, 2180, 3234, 7292,  297, 2174, 6960, 4979, 5503, 5350, 3281,
        4736, 2841, 5833, 5549, 1870, 2090,  824, 3496, 7069, 3900,  993, 1403,
        6123, 5143, 6398, 5892,  457, 2971, 7551, 3882, 5785, 2055, 3423, 6879,
        5063, 3890, 1508, 2135, 6536, 5184,  942, 7020, 5969,   54, 6867,  164,
        2504,   76, 1977,  222, 5006, 3995, 5603, 3388, 4055, 4845, 2130, 4941,
        7335, 5158,  820, 5808, 1560, 5430, 1147, 4173, 4637, 6931, 5409, 4559,
        7231, 1408, 4970, 1102,  176, 4197, 2677, 3618, 3694, 2852, 6351, 7019,
        1932, 1723, 1658, 2925, 6044, 2395, 4496,  306, 6728, 7141, 3972, 2242,
         291,  985, 6580, 3070, 2650, 6212, 1064, 6730, 3276, 7065,  967, 6275,
        6105, 5629, 3003, 4018, 7331, 7539, 2165, 2664,  460, 3718, 6171,  365,
        4291, 5857, 1138, 7174, 4949, 1387, 2132, 6915, 5237, 4371, 5906, 7176,
        4638, 2233, 1955, 6499,  759, 1895, 5192, 6086, 5323, 1677, 4375, 6016,
        4957, 6760, 3115,   95, 5319, 3670, 1542, 1023,  143, 5227, 1650, 5217,
          42, 3237, 3160, 1703,  338, 1128, 2252, 5593,  645, 5024, 5290, 3951,
        5318, 2602, 5296, 2366]), tensor([1893, 1014, 4663, 7026, 5815, 7544,  255, 2935, 7188, 5401, 3039, 1091,
         651, 6787,  638, 3049, 1996, 1838, 2060, 1586,  395, 2322, 1376,  248,
        3906, 3913,  865, 6087, 3223,  970, 2342, 6643, 6302, 4915, 6379, 5696,
        6668, 4518, 2809, 6914, 2212, 6432,  887, 6999, 5187, 7043, 2911, 3892,
        1451, 6231, 1652, 1317,  833, 6290, 3652, 1342, 3532, 5047, 7427, 1597,
        6246, 4927, 6278,   28, 5774, 1785,   25, 4373, 6259,   57, 7424,   84,
        3627, 2700, 4006, 3925, 3595, 1771,  520, 4406, 6436, 4458, 4893, 4897,
        5151,  152, 1121, 7546,  242, 3884, 2771, 5594, 3872,  795,   10,  301,
        1324, 6354, 6515, 6839, 2403, 5282,  754, 5198, 4039, 5443, 6573, 2684,
        3241,  972, 2052, 2419, 4145, 5874, 3683, 2287, 3725, 7609, 3395, 5341,
        7455,  733, 1430, 1682, 2029, 2573, 1165, 3619, 7422, 7139, 4105, 2169,
        5002, 4664, 4025, 6882, 1078, 3367, 2351, 4326, 3379, 1321, 2050,  772,
        1782, 4035,  543, 5491,  551, 4058, 1592, 4621, 7423, 2004, 2496, 4572,
        4580, 2799,  879, 1495, 6665, 3685,  947, 5564, 2912, 2346, 4345, 6114,
        1294, 3123, 3052, 5420, 6271, 6679, 3282, 5017, 5215, 2360, 2993, 4764,
        5683, 3335, 1213, 3750, 4280,  217,  544, 2793, 1820,  202, 4179, 2013,
         659, 4295, 5153, 5426, 5608,  128, 3135, 7563, 4894, 6189,  674, 3195,
          33, 7201, 3381, 4001, 4395, 3960, 7336, 3439, 6831, 2106,  829, 6339,
        6263, 4697, 5378, 2749, 1273, 6604, 4905, 4651, 1641, 4507, 1141, 1707,
        7396, 2967, 2916, 2087, 1123, 5243, 7448, 3094, 7381,  125, 4800, 1817,
        4335, 4403,  328, 3534,  444,  736, 3311, 3509, 2568, 5514, 7074, 3759,
        5590, 3827,  931, 2890, 7573, 1797, 6092, 3715, 2470, 3656, 6118, 1881,
        6743, 4561, 6072, 7408, 3318, 4685, 7132, 1434,  655, 2563, 1618, 6660,
        1057, 7601, 1105, 2589, 4874, 3178, 1928, 4655, 6721, 5918, 4777, 5540,
        6564, 6602, 4650, 7249,  468,  620, 5080, 5659, 2367, 1716, 6055, 2820,
        5137, 1008, 1844, 2341, 6021, 7159, 7471, 1522, 6814, 5896, 6146, 4423,
        7575, 6030, 6989, 3434,  480, 3372, 3333, 5950, 6410, 4526, 6711, 5256,
        4286, 4313, 6974, 3605, 4221, 3586,  822, 5863, 6554, 4674, 6349, 1162,
        7550, 3410, 1255, 3471, 2831, 4383, 4304, 3433, 5225, 3904, 2467, 6520,
        2976, 6865, 4231, 1087, 6645, 2897,  210,  357, 2494, 3831, 1299, 7535,
        6726, 6488,  588, 4299,  662, 3449, 2836, 2020, 6518,  258, 4774, 3082,
        1916, 1456, 1322, 6983, 3425, 7436, 2122, 1291, 3922, 6870, 7157, 7508,
        7127, 6592, 7607, 4881, 3456, 6248, 6222, 6405, 6333, 1966, 1666, 3798,
        1391, 2304, 6618, 4081, 7338, 4641, 3397, 7316, 6967, 7369, 1989,  770,
        7309, 4289, 3251, 1861, 1204, 4931,  312, 7190, 3142,  104, 1800, 3565,
        7604, 6817, 2336, 3762, 2631, 4292,   14, 2790, 4091, 1899, 4862,  541,
        5793, 3615, 3236, 4883,  851, 2187, 1917, 4624, 1060, 1449, 3911,  483,
        1903, 5600,  688, 5161, 6597, 5750, 5582, 3806, 5373, 4223, 4007, 5840,
        5103, 6000,  225, 7600,  160,  158, 5641, 5119, 1190, 6752, 3989,  504,
        4152, 2667, 3361,  678, 2381, 5627, 3489, 6473,   91, 1901, 6887, 3914,
        5489, 3167, 5694, 7384, 3589,  907,  450, 5804, 1307, 1158,  690, 2970,
         442, 3804, 4446,  799, 3748, 5263, 1747, 6156, 4910, 5934, 6177, 1503,
        1533, 7465, 3130, 4497,  928, 3143, 1210, 4101,  579,  755, 2615, 2289,
        5964, 7016, 4500, 1958, 3038,  303, 2754, 2422,  905, 3391, 6898, 3482,
        1371,  670,  890, 1866, 4191, 5872, 3146, 2086, 1787, 7078, 7070, 5902,
        1744,  249, 5049, 2843,  351, 4583, 4594, 5384, 6988, 5538, 1432,  535,
        1907, 2887, 3137, 1261, 2356, 2022, 1224, 5112,  253, 6014, 4042, 4136,
        2240,  684, 3566, 1032, 2768, 5098, 1570, 3813, 7606, 6948, 4368, 7285,
        2769, 6682, 3637,  582, 4098, 4348, 6548, 5333, 5395, 3887, 6551, 3816,
        7058, 7235, 6308,  116, 2198, 6622, 7165, 5495, 1671, 2848, 6789, 4049,
        1364,  454, 5327, 2222, 1439,  239, 2534, 2491, 6819, 5238, 7244, 7503,
        4947, 2617, 6532, 5684, 6464, 7105, 1850, 4433, 6430, 1242, 1645, 4599,
        7353,  943, 2574, 2632, 6951, 2285, 7092, 7365, 7287, 3493, 1801, 7061,
        3705, 5264, 4312, 5498, 6027, 5788, 2904, 7486, 7417, 5731, 5148, 1459,
        3550, 6700, 5067,  835, 7081, 7458, 5387, 6292, 4102, 7037, 2618, 6462,
        7572,  475, 5424, 6166, 5465, 2522, 7032, 4711, 2586,  844, 2209, 4219,
        6605, 2847, 4848,  204, 3134, 3664, 2310, 3635, 4721, 7537, 1230, 7364,
        1103,  757, 5358, 6991, 5470, 6958, 5567, 1889, 1684, 3348, 5367, 2062,
         266, 4676, 1720, 4451, 3930, 7284, 7108, 5878, 6335, 2578, 2497, 2579,
        4185, 6097, 5647, 3863, 2092, 1777, 4250, 2073, 1350, 1203, 4793, 5302,
        3378, 1169, 3932, 5030, 3840,  318, 2008, 1987, 4899, 1305, 3522, 2408,
        5505,  388, 4044, 4587, 5991, 3856,  386, 4377, 4118, 6793, 1409, 6329,
        2472, 2884, 5780, 1235, 5398, 6613, 1864, 7022, 3963,  918, 4469,  975,
           8, 3536,  185, 4575, 4768,  700, 4550, 1167, 2894, 1945, 3308, 1589,
        5675, 5289, 5712, 7562, 2622, 4546, 2762, 3245, 6970, 4257, 3215, 5957,
        7197, 4114, 3581, 4168, 3843, 3978, 4851,  385, 6553, 3964, 3081, 5717,
        6453, 1234, 7107,  219, 2025, 2118,  871, 1602, 1842, 6192, 5452, 4209,
        5604, 5997, 5060, 4038, 2479,  141,   98, 4982,  693, 2371, 3861, 3172,
        7622, 4265, 5235, 4922,  695, 1814,  830,  334, 3461, 7586, 3303, 1753,
        6476, 2718, 1358, 3234, 7278,  566, 1755, 6944, 4998, 6327, 5364, 3281,
        4738, 2450, 5833, 5532, 1858, 2108,  529, 3075, 7069, 3481, 1011, 1044,
        6123, 5163, 6398, 5891,  464, 2951, 7392, 3883, 5784, 2054, 3822, 6513,
        5063, 3033, 1500, 1715, 7207, 5201,  979, 6690, 5990,  183, 6866,   38,
        2526,   68, 1976,  221, 4110, 3993, 5180, 3386, 4055, 4409, 1710, 4956,
        7307, 4739,  507, 5807, 1974, 5848, 1529, 3744, 5095, 6931, 5810, 4977,
        7231, 1407, 4950, 1493,  150, 4656, 3118, 3205, 3713, 3253, 6725, 6688,
        1920, 1303, 1657, 2945, 6025, 2395, 5346,  123, 6714, 6821, 4418, 2256,
         546,  643, 6934, 2673, 2635, 6211, 1424, 6325, 3278, 6754, 1354, 5427,
        6103, 5630, 2983, 4009, 7332, 7345, 2165, 3120,  751, 3717, 5751,  366,
        4728, 5028, 1154, 7161, 4512, 1015, 1328, 6925, 5662, 4372, 5488, 7187,
        4639, 2247, 1955, 6096,  766, 1875, 5209, 6069, 5337, 2076, 4390, 6420,
        4084, 6389, 2278,  522, 5319, 3688,  778, 1004,  155, 5652, 1231, 5672,
         181, 2389, 2721, 1704,  337, 1129, 2238, 5170,  383, 4547, 4841, 3966,
        5311, 2177, 6141, 2400]))
</pre></div>
</div>
<p>Letâ€™s plot the probability map of target voxels being matched with
the 300th source voxel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pi</span> <span class="o">=</span> <a href="../../modules/mappings.FUGWSparse.html#fugw.mappings.FUGWSparse" title="fugw.mappings.FUGWSparse" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fine_mapping</span></a><span class="o">.</span><span class="n">pi</span>
<span class="n">vertex_index</span> <span class="o">=</span> <span class="mi">300</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_hot</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_features</span></a><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_hot</span></a><span class="p">[</span><span class="n">vertex_index</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">probability_map</span></a> <span class="o">=</span> <a href="../../modules/mappings.FUGWSparse.html#fugw.mappings.FUGWSparse.inverse_transform" title="fugw.mappings.FUGWSparse.inverse_transform" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-method"><span class="n">fine_mapping</span><span class="o">.</span><span class="n">inverse_transform</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_hot</span></a><span class="p">)</span>

<a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="matplotlib.pyplot.figure" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.add_subplot" title="matplotlib.figure.Figure.add_subplot" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span></a><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.scatter.html#matplotlib.axes.Axes.scatter" title="matplotlib.axes.Axes.scatter" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span></a><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">probability_map</span></a><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;twilight&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
<span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.text.html#matplotlib.axes.Axes.text" title="matplotlib.axes.Axes.text" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">text</span></a><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[</span><span class="n">vertex_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[</span><span class="n">vertex_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[</span><span class="n">vertex_index</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;x Source point&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_title.html#matplotlib.axes.Axes.set_title" title="matplotlib.axes.Axes.set_title" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span></a><span class="p">(</span>
    <span class="s2">&quot;Probability map of target voxels</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;being matched with source point </span><span class="si">{</span><span class="n">vertex_index</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_axis_off.html#matplotlib.axes.Axes.set_axis_off" title="matplotlib.axes.Axes.set_axis_off" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span></a><span class="p">()</span>
<a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.colorbar" title="matplotlib.figure.Figure.colorbar" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><a href="https://matplotlib.org/stable/api/cm_api.html#matplotlib.cm.ScalarMappable" title="matplotlib.cm.ScalarMappable" class="sphx-glr-backref-module-matplotlib-cm sphx-glr-backref-type-py-class"><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span></a><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;twilight&quot;</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_2_aligning_high_res_volumes_002.png" srcset="../../_images/sphx_glr_plot_2_aligning_high_res_volumes_002.png" alt="Probability map of target voxels being matched with source point 300" class = "sphx-glr-single-img"/><p>We can now align test contrasts using the fitted fine mapping.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">contrast_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">predicted_target_features</span></a> <span class="o">=</span> <a href="../../modules/mappings.FUGWSparse.html#fugw.mappings.FUGWSparse.transform" title="fugw.mappings.FUGWSparse.transform" class="sphx-glr-backref-module-fugw-mappings sphx-glr-backref-type-py-method"><span class="n">fine_mapping</span><span class="o">.</span><span class="n">transform</span></a><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_features</span></a><span class="p">[</span><span class="n">contrast_index</span><span class="p">,</span> <span class="p">:]</span>
<span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">predicted_target_features</span></a><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(7633,)
</pre></div>
</div>
<p>Letâ€™s compare the Pearson correlation between source and target features.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">corr_pre_mapping</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.corrcoef.html#numpy.corrcoef" title="numpy.corrcoef" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span></a><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_features</span></a><span class="p">[</span><span class="n">contrast_index</span><span class="p">,</span> <span class="p">:],</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_features</span></a><span class="p">[</span><span class="n">contrast_index</span><span class="p">,</span> <span class="p">:]</span>
<span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">corr_post_mapping</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.corrcoef.html#numpy.corrcoef" title="numpy.corrcoef" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span></a><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">predicted_target_features</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_features</span></a><span class="p">[</span><span class="n">contrast_index</span><span class="p">,</span> <span class="p">:]</span>
<span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pearson Correlation pre-mapping: </span><span class="si">{</span><a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">corr_pre_mapping</span></a><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pearson Correlation post-mapping: </span><span class="si">{</span><a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">corr_post_mapping</span></a><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Relative improvement:&quot;</span>
    <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">corr_post_mapping</span></a><span class="w"> </span><span class="o">-</span><span class="w"> </span><a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">corr_pre_mapping</span></a><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">corr_pre_mapping</span></a><span class="w"> </span><span class="o">*</span><span class="mi">100</span><span class="w"> </span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Pearson Correlation pre-mapping: 0.36
Pearson Correlation post-mapping: 0.47
Relative improvement: 30.09 %
</pre></div>
</div>
<p>Letâ€™s plot the transporting feature maps of the test set.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="matplotlib.pyplot.figure" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figaspect</span><span class="p">(</span><span class="mf">0.3</span><span class="p">))</span>
<a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.suptitle" title="matplotlib.figure.Figure.suptitle" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span></a><span class="p">(</span><span class="s2">&quot;Transporting feature maps of the test set&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.add_subplot" title="matplotlib.figure.Figure.add_subplot" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.scatter.html#matplotlib.axes.Axes.scatter" title="matplotlib.axes.Axes.scatter" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span></a><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">source_features_normalized</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;twilight&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_title.html#matplotlib.axes.Axes.set_title" title="matplotlib.axes.Axes.set_title" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span></a><span class="p">(</span><span class="s2">&quot;Source features&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_axis_off.html#matplotlib.axes.Axes.set_axis_off" title="matplotlib.axes.Axes.set_axis_off" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span></a><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.add_subplot" title="matplotlib.figure.Figure.add_subplot" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.scatter.html#matplotlib.axes.Axes.scatter" title="matplotlib.axes.Axes.scatter" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span></a><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">predicted_target_features</span></a><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;twilight&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_title.html#matplotlib.axes.Axes.set_title" title="matplotlib.axes.Axes.set_title" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span></a><span class="p">(</span><span class="s2">&quot;Predicted target features&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_axis_off.html#matplotlib.axes.Axes.set_axis_off" title="matplotlib.axes.Axes.set_axis_off" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span></a><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.add_subplot" title="matplotlib.figure.Figure.add_subplot" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.scatter.html#matplotlib.axes.Axes.scatter" title="matplotlib.axes.Axes.scatter" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span></a><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_features_normalized</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;twilight&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_title.html#matplotlib.axes.Axes.set_title" title="matplotlib.axes.Axes.set_title" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span></a><span class="p">(</span><span class="s2">&quot;Actual target features&quot;</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_axis_off.html#matplotlib.axes.Axes.set_axis_off" title="matplotlib.axes.Axes.set_axis_off" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span></a><span class="p">()</span>
<a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.colorbar" title="matplotlib.figure.Figure.colorbar" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><a href="https://matplotlib.org/stable/api/cm_api.html#matplotlib.cm.ScalarMappable" title="matplotlib.cm.ScalarMappable" class="sphx-glr-backref-module-matplotlib-cm sphx-glr-backref-type-py-class"><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span></a><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;twilight&quot;</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_2_aligning_high_res_volumes_003.png" srcset="../../_images/sphx_glr_plot_2_aligning_high_res_volumes_003.png" alt="Transporting feature maps of the test set, Source features, Predicted target features, Actual target features" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 10 minutes  22.412 seconds)</p>
<p><strong>Estimated memory usage:</strong>  920 MB</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-02-volumetric-alignment-plot-2-aligning-high-res-volumes-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/27620db1a3e529247a546ea2ff0f6b4d/plot_2_aligning_high_res_volumes.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_2_aligning_high_res_volumes.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/767b08eb6283b48c3d8815e986ceb365/plot_2_aligning_high_res_volumes.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_2_aligning_high_res_volumes.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../pages/api_references.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API references</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="plot_1_aligning_low_res_volumes.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Align low-resolution brain volumes of 2 individuals with fMRI data</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022-2023, the fugw team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    </body>
</html>